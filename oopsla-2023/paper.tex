\documentclass[acmsmall,review,anonymous]{acmart}

%\settopmatter{printfolios=true,printccs=false,printacmref=false}


\overfullrule=3mm
\citestyle{acmauthoryear}
%\setcitestyle{round}

\usepackage{multirow}

\usepackage{alltt}
% \usepackage{amssymb}
\usepackage{calc}
\usepackage{cleveref}
\usepackage{colortbl}
\usepackage{listings}
\usepackage{mathpartir}
\usepackage{graphicx}
\usepackage{pifont}
\usepackage{subcaption}
\usepackage{tikz}
\usepackage{wrapfig}
\usepackage{xcolor}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}

\usepackage{moreverb}

\input{def.tex}

\begin{document}

\title{How Profilers Can Help Navigate Type Migration}

\author{Ben Greenman}
\orcid{0000-0001-7078-9287}
\affiliation{%
  \institution{PLT @ Brown University}
  \city{Providence}
  \state{Rhode Island}
  \country{USA}
}
\email{benjaminlgreenman@gmail.com}

\author{Matthias Felleisen}
\orcid{0000-0001-6678-1004}
\affiliation{%
  \institution{PLT @ Northeastern University}
  \city{Boston}
  \state{Massachusetts}
  \country{USA}
}
\email{matthias@ccs.neu.edu}

\author{Christos Dimoulas}
\orcid{0000-0002-9338-7034}
\affiliation{%
  \institution{PLT @ Northwestern University}
  \city{Evanston}
  \state{Illinois}
  \country{USA}
}
\email{chrdimo@northwestern.edu}

%\renewcommand{\shortauthors}{...}

%%
%% The abstract is a short summary of the work to be presented in the
%% article.
\input{abstract.tex}

%%
%% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
%% Please copy and paste the code instead of the example below.

\begin{CCSXML}
\input{ccsxml.tex}
\end{CCSXML}

\ccsdesc[500]{Software and its engineering~Semantics}
\ccsdesc[100]{Software and its engineering~Constraints}
\ccsdesc[100]{Software and its engineering~Functional languages}

\newcommand{\code}[1]{\texttt{#1}}
\newcommand{\stdrkt}{\code{v8.6.0.2 [cs]}}
\newcommand{\bmname}[1]{\textsf{#1}}
\newcommand{\totalnumconfigs}{116,163}
\newcommand{\totalnummeasurements}{1,277,793}
%% 2023-03-22 bg: configs + runs ignoring quadT
\newcommand{\machinename}[1]{\texttt{#1}}
\newcommand{\commitname}[2]{\texttt{#1}}
\newcommand{\gcell}[1]{\cellcolor{green!20}#1}
\newcommand{\wcell}[1]{\cellcolor{black!05}#1}
\newcommand{\ycell}[1]{\cellcolor{yellow!18}#1}
\newcommand{\ocell}[1]{\cellcolor{orange!29}#1}
\newcommand{\rcell}[1]{\cellcolor{red!30}#1}
\newcommand{\tcell}[1]{\cellcolor{black!10}#1}

\keywords{complete monitoring, blame soundness, blame completeness}

\maketitle

%% -----------------------------------------------------------------------------
\def\sec#1#2{\section{#2} \label{sec:#1} \input{#1.tex}}

\sec{intro}       {Type Migration as a Navigation Problem}
\sec{seascape}    {Navigating the Deeps and Shallows via Profiling Tools}
\sec{ideas}       {A Rational Approach to Navigation}
\sec{experiment}  {From a Rational Approach to a Rational Programmer Experiment}
\sec{results}     {What are the Results of the Rational Programmer Experiment}
\sec{discussion}  {What Can Programmers Learn from the Rational Programmer}
\sec{related}     {What Does Prior Research Say About This Problem}
\sec{conclusion}  {Where to Go from Here}
%% -----------------------------------------------------------------------------


\begin{acks}
  Thanks to Cloudlab for hosting our experiments [CITE].

We gratefully acknowledge support from
  \grantsponsor{NSF}{NSF}{https://www.nsf.gov}
 grants
  (?) \href{"https://www.nsf.gov/awardsearch/showAward?AWD_ID=1763922"}{\grantnum{NSF}{CCF 1763922}},
  (?) \href{"https://www.nsf.gov/awardsearch/showAward?AWD_ID=1823244"}{\grantnum{NSF}{CNS 1823244}},
 and
 \href{"https://www.nsf.gov/awardsearch/showAward?AWD_ID=2030859"}{\grantnum{NSF}{CCF 2030859}}
  to the CRA for the \href{https://cifellows2020.org}{CIFellows} project.
\end{acks}

\bibliographystyle{ACM-Reference-Format}
\bibliography{bib}

\appendix

\section{Modifications to the GTP Benchmarks}

To support a rational programmer experiment using feature-specific profiling,
we had to change nine of the GTP Benchmarks in a minor way.
The change lets the profiler peek through \emph{adaptor modules}.
Adaptor modules are a layer of indirection that lets benchmark with
generative types (structs)support a lattice of mixed-typed
configurations~\cite{gtp-benchmarks,tfgnvf-popl-2016}.
The benchmarks are:
\bmname{acquire}, \bmname{kcfa},
\bmname{snake}, \bmname{suffixtree}, \bmname{synth}, \bmname{take5},
\bmname{tetris}, and \bmname{zombie}.
%% FILL also quadT

In short, the trouble with an adaptor is that its name appears
in contracts instead of the name of its clients.
If one adaptor has three clients, then profiling will attribute costs to one
library--adaptor boundary instead of three library--client boundaries.

The change is to add client-specific submodules to each adaptor.
Using an adaptor with three clients as an example, the changes are:
\begin{enumerate}
  \item
    define generative types at the top level of the adaptor;
  \item
    export the generative types \emph{unsafely}, without any contract;
  \item
    create three submodules, one for each client, each of which imports
    the generative types and provides them safely; and
  \item
    modify the clients to import from the newly-created submodules rather
    than the top level.
\end{enumerate}
%
The submodules attach client-specific names to contracts without changing
run-time behavior.


\section{FILL Skyline}

\begin{figure}[t]
  \newcommand{\kkrow}[1]{\bmname{#1} \\ \includegraphics[width=0.39\columnwidth]{data/sky/#1-feasible.pdf}}
  \begin{tabular}[t]{ll}
    \begin{tabular}[t]{l}
      \kkrow{morsecode} \\
      \kkrow{forth} \\
      \kkrow{fsm} \\
      \kkrow{fsmoo} \\
      \kkrow{mbta} \\
      \kkrow{zombie} \\
      \kkrow{dungeon} \\
      \kkrow{jpeg} \\
    \end{tabular}
    &
    \begin{tabular}[t]{l}
      \kkrow{lnm} \\
      \kkrow{suffixtree} \\
      \kkrow{kcfa} \\
      \kkrow{snake} \\
      \kkrow{take5} \\
      \kkrow{acquire} \\
      \kkrow{tetris} \\
      \kkrow{synth}
    \end{tabular}
  \end{tabular}

  \caption{FILL skyline}
  \label{f:skyline:bm}
\end{figure}


\section{FILL Head to Head}

\begin{figure}[t]
  \newcommand{\hhrow}[1]{\bmname{#1} \\ \includegraphics[width=0.39\columnwidth]{data/h2h/#1.pdf}}
  \begin{tabular}[t]{ll}
    \begin{tabular}[t]{l}
      \hhrow{morsecode} \\
      \hhrow{forth} \\
      \hhrow{fsm} \\
      \hhrow{fsmoo} \\
      \hhrow{mbta} \\
      \hhrow{zombie} \\
      \hhrow{dungeon} \\
      \hhrow{jpeg} \\
    \end{tabular}
    &
    \begin{tabular}[t]{l}
      \hhrow{lnm} \\
      \hhrow{suffixtree} \\
      \hhrow{kcfa} \\
      \hhrow{snake} \\
      \hhrow{take5} \\
      \hhrow{acquire} \\
      \hhrow{tetris} \\
      \hhrow{synth}
    \end{tabular}
  \end{tabular}

  \caption{FILL Head to head, per benchmark}
  \label{f:h2h:bm}
\end{figure}

\end{document}
\endinput
