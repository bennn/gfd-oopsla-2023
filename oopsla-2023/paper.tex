\documentclass[acmsmall,review,anonymous]{acmart}

%\settopmatter{printfolios=true,printccs=false,printacmref=false}

%% NOTES among authors 
\def\notes#1{\expandafter\def\csname#1\endcsname##1{\marginpar{\par\noindent\hrulefill\par\raggedright\tiny\noindent #1: ##1}}}
% \def\notes#1{\expandafter\def\csname#1\endcsname##1{\marginpar{\relax}}}
\notes{bg}
\notes{cd}
\notes{mf}

\overfullrule=1mm
\citestyle{acmauthoryear}
%\setcitestyle{round}

\usepackage{alltt}
% \usepackage{amssymb}
\usepackage{calc}
\usepackage{cleveref}
\usepackage{listings}
\usepackage{mathpartir}
\usepackage{pifont}
\usepackage{tikz}
\usepackage{wrapfig}
\usepackage{xcolor}
\usetikzlibrary{shapes.geometric}

\begin{document}

\title{Exploring the Deeps and Shallows: A Rational Programmer Study of How Various Profilers Can Guide 3D Type Migration}

\author{Ben Greenman}
\orcid{0000-0001-7078-9287}
\affiliation{%
  \institution{PLT @ Brown University}
  \city{Providence}
  \state{Rhode Island}
  \country{USA}
}
\email{benjaminlgreenman@gmail.com}

\author{Matthias Felleisen}
\orcid{0000-0001-6678-1004}
\affiliation{%
  \institution{PLT @ Northeastern University}
  \city{Boston}
  \state{Massachusetts}
  \country{USA}
}
\email{matthias@ccs.neu.edu}

\author{Christos Dimoulas}
\orcid{0000-0002-9338-7034}
\affiliation{%
  \institution{PLT @ Northwestern University}
  \city{Evanston}
  \state{Illinois}
  \country{USA}
}
\email{chrdimo@northwestern.edu}

%\renewcommand{\shortauthors}{...}

%%
%% The abstract is a short summary of the work to be presented in the
%% article.
\begin{abstract}
  TBD
\end{abstract}

%%
%% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
%% Please copy and paste the code instead of the example below.

\begin{CCSXML}
\input{ccsxml.tex}
\end{CCSXML}

\ccsdesc[500]{Software and its engineering~Semantics}
\ccsdesc[100]{Software and its engineering~Constraints}
\ccsdesc[100]{Software and its engineering~Functional languages}

\newcommand{\bmname}[1]{\textsf{#1}}

\keywords{complete monitoring, blame soundness, blame completeness}

\maketitle

\section{Introduction}
\label{s:introduction}

Rational programmer~\cite{lgfd-icfp-2021}.


\section{Data}

runtime from one cluster and one racket.
exceptions: dungeon, quadT, morsecode (todo)

boundary from another cluster, same racket
exceptions: dungeon, morsecode
profile, ditto


\section{Results}
\label{s:data}

A benchmark is a family of programs.
There are $3^N$ program configurations (\emph{configurations} for short)
in each family, where $N$ is the number of \emph{migratable} modules.
These modules can depend on any number of additional \emph{contextual} modules.

A migration target (\emph{target}) is a set of modules that should be equipped
with types.
There are $2^N$ targets per benchmark.

For our experiments, we consider every configuration as a starting point.
From the starting point, the goal is to reach a fast configuration without
removing types from a module.
(In other words, the \emph{target} is the set of typed modules in the start
configuration.)
A fast configuration runs at least as quickly as the untyped code.
Using the established terminology~\cite{vss-popl-2017,bbst-oopsla-2017},
we instatiate the Takikawa constant to 1x ($T=1$).

A very simple way to try improving performance is to toggle between
Deep and Shallow.
\citet{g-pldi-2022} provides justification.
Any configuration can reach 0, 1, or 2 other configurations by
toggling, that is, by changing all its typed modules to Deep or
changing all to Shallow.
(Only the untyped configuration can reach 0 others.)

First question: for how many configurations does $T=1$ present a debugging challenge?
More precisely, how many cannot reach $T=1$ by toggling?

(The untyped configuration can trivially reach $T=1$.
The fully-typed configuration can usually reach $T=1$, unless there are heavy
boundaries to untyped contextual modules.)

\Cref{t:baseline-trouble} shows that many benchmarks need help,
over 100k configurations in total.
The median \% that need help is 82\%.
Only \bmname{fsm} and \bmname{lnm} have low percentages: 8\% and 44\%.

\begin{table}[t]
  \caption{How many of the $3^N$ configurations need help to reach $T=1$?}

  \label{t:baseline-trouble}
  \begin{tabular}{lrr}
    Benchmark  & Count & Pct \\\midrule
    sieve      & 8     & 88.89\% \\
    morsecode  & 55    & 67.90\% \\
    forth      & 74    & 91.36\% \\
    fsm        & 36    & 44.44\% \\
    fsmoo      & 50    & 61.73\% \\
    mbta       & 72    & 88.89\% \\
    zombie     & 64    & 79.01\% \\
    dungeon    & 242   & 99.59\% \\
    jpeg       & 168   & 69.14\% \\
    lnm        & 57    &  7.82\% \\
    suffixtree & 584   & 80.11\% \\
    kcfa       & 1799  & 82.26\% \\
    snake      & 6560  & 99.98\% \\
    take5      & 6558  & 99.95\% \\
    acquire    & 19495 & 99.04\% \\
    tetris     & 14879 & 75.59\% \\
    synth      & 58022 & 98.26\% \\
  \end{tabular}

\end{table}



\section{Discussion}
\label{s:conclusion}
\label{s:discussion}



\begin{acks}
  Thanks to Cloudlab for hosting our experiments [CITE].

We gratefully acknowledge support from
  \grantsponsor{NSF}{NSF}{https://www.nsf.gov}
 grants
  (?) \href{"https://www.nsf.gov/awardsearch/showAward?AWD_ID=1763922"}{\grantnum{NSF}{CCF 1763922}},
  (?) \href{"https://www.nsf.gov/awardsearch/showAward?AWD_ID=1823244"}{\grantnum{NSF}{CNS 1823244}},
 and
 \href{"https://www.nsf.gov/awardsearch/showAward?AWD_ID=2030859"}{\grantnum{NSF}{CCF 2030859}}
  to the CRA for the \href{https://cifellows2020.org}{CIFellows} project.
\end{acks}

\bibliographystyle{ACM-Reference-Format}
\bibliography{bib}

\end{document}
\endinput
